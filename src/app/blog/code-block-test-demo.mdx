---
title: "Code Block Feature Test Demo"
date: "2025-01-06"
excerpt: "Testing all the new code block features"
category: "Demo"
readTime: "5 min"
tags: ["Demo"]
---

# Code Block Feature Test Demo

This page demonstrates all the new code block features.

## 1. Basic Code Block with Copy Button

```python
def hello_world():
    print("Hello, World!")
    return 42
```

## 2. Code Block with File Name

```python fileName="app.py"
from flask import Flask

app = Flask(__name__)

@app.route('/')
def home():
    return "Welcome to Flask!"

if __name__ == '__main__':
    app.run(debug=True)
```

## 3. Long Code Block (Collapsible)

```javascript fileName="auth0-action.js"
exports.onExecutePostLogin = async (event, api) => {
  // Define a namespace for custom claims to avoid collisions
  const namespace = `https://example.com/permissions`;
  const ManagementClient = require('auth0').ManagementClient;

  console.log(`Namespace for custom claims: ${namespace}`);

  // Initialize the Auth0 ManagementClient
  const management = new ManagementClient({
    domain: event.secrets.AUTH0_DOMAIN,
    clientId: event.secrets.AUTH0_MGMT_CLIENT_ID,
    clientSecret: event.secrets.AUTH0_MGMT_CLIENT_SECRET,
  });

  console.log(`Auth0 Management Client ID: ${event.secrets.AUTH0_MGMT_CLIENT_ID}`);

  // Check if the user has assigned roles
  if (event.authorization && event.authorization.roles) {
    try {
      let permissions = []; // Array to hold all permissions from all roles

      // Iterate over each role assigned to the user
      for (const roleName of event.authorization.roles) {
        console.log(`Processing role: ${roleName}`);

        // Fetch all roles from Auth0 to find the ID of the current roleName
        const allRolesResponse = await management.roles.getAll();
        const allRoles = allRolesResponse.data;

        // Find the specific role by its name
        const roles = allRoles.filter((role) => role.name === roleName);
        console.log(`Roles matching '${roleName}':`, roles);

        if (!roles.length || !roles[0].id) {
          console.error(`Role not found or invalid ID for role name: ${roleName}`);
          continue;
        }

        const roleId = roles[0].id;
        console.log(`Role ID for ${roleName}: ${roleId}`);

        // Fetch the permissions associated with this role ID
        const rolePermissionsResponse = await management.roles.getPermissions({ id: roleId });
        const rolePermissions = rolePermissionsResponse.data;
        console.log(`Permissions for ${roleName}:`, rolePermissions);

        // Add the permission names to our permissions array
        permissions = permissions.concat(rolePermissions.map((p) => p.permission_name));
      }

      // Remove any duplicate permissions
      permissions = [...new Set(permissions)];

      // Set the custom claim in the ID token
      api.idToken.setCustomClaim(namespace, permissions);
      console.log(`Custom claim set in ID token. Permissions: ${permissions}`);
    } catch (error) {
      console.error(`Error fetching permissions for roles: ${error.message}`);
    }
  }
};
```

## 4. Code with Very Long Lines (Horizontal Scrolling)

```python
from sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV, RandomizedSearchCV, StratifiedKFold, learning_curve, validation_curve

# This is a very long dictionary definition that demonstrates horizontal scrolling in our new code blocks
hyperparameters = {'n_estimators': [100, 200, 300, 400, 500], 'max_depth': [None, 10, 20, 30, 40, 50], 'min_samples_split': [2, 5, 10], 'min_samples_leaf': [1, 2, 4], 'max_features': ['auto', 'sqrt', 'log2'], 'bootstrap': [True, False]}

# Another example with a long string
long_sql_query = "SELECT users.id, users.name, users.email, orders.order_id, orders.total, orders.created_at, products.name as product_name, products.price FROM users INNER JOIN orders ON users.id = orders.user_id INNER JOIN order_items ON orders.order_id = order_items.order_id INNER JOIN products ON order_items.product_id = products.id WHERE orders.created_at > '2024-01-01' AND users.country = 'USA' ORDER BY orders.created_at DESC;"
```

## 5. Multiple Language Support

### SQL
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample data
INSERT INTO users (username, email)
VALUES ('john_doe', 'john@example.com'),
       ('jane_smith', 'jane@example.com');
```

### Docker
```dockerfile fileName="Dockerfile"
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000
CMD ["gunicorn", "app:app", "--bind", "0.0.0.0:8000"]
```

### YAML
```yaml fileName="docker-compose.yml"
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/myapp
    depends_on:
      - db
  
  db:
    image: postgres:13
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
      - POSTGRES_DB=myapp
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### Diff
```diff
- const old_function = () => {
-   console.log("This is the old implementation");
-   return false;
- };
+ const new_function = () => {
+   console.log("This is the new and improved implementation");
+   return true;
+ };

  // Unchanged code
  const helper = () => {
    console.log("This stays the same");
  };
```

## 6. Line Highlighting

Here's a function with lines 2 and 4-6 highlighted:

```javascript {2,4-6}
function fibonacci(n) {
  if (n <= 1) return n;  // This line is highlighted
  
  let prev = 0;          // This line is highlighted
  let current = 1;       // This line is highlighted
  
  for (let i = 2; i <= n; i++) {  // This line is highlighted
    const temp = current;
    current = prev + current;
    prev = temp;
  }
  
  return current;
}
```

Another example with different highlights:

```python {1,3,8-10}
def merge_sort(arr):  # Highlighted
    if len(arr) <= 1:
        return arr  # Highlighted
    
    mid = len(arr) // 2
    left = merge_sort(arr[:mid])
    right = merge_sort(arr[mid:])
    
    # Merge the sorted halves - these 3 lines highlighted
    return merge(left, right)
```

## 7. Nested Code Structures

```python fileName="complex_example.py"
class DataProcessor:
    def __init__(self, config):
        self.config = config
        self.data = []
        
    def process_batch(self, batch):
        """Process a batch of data with error handling"""
        results = []
        
        for item in batch:
            try:
                # Complex nested logic
                if isinstance(item, dict):
                    if 'data' in item:
                        processed = {
                            'id': item.get('id', 'unknown'),
                            'result': self._transform(item['data']),
                            'metadata': {
                                'timestamp': datetime.now(),
                                'version': self.config.get('version', '1.0'),
                                'tags': item.get('tags', [])
                            }
                        }
                        results.append(processed)
                    else:
                        raise ValueError("Missing 'data' field")
                else:
                    results.append({'error': 'Invalid item type'})
                    
            except Exception as e:
                logger.error(f"Error processing item: {e}")
                results.append({'error': str(e)})
                
        return results
```

## Features Summary

All code blocks now include:
- 🔲 **Copy-to-clipboard** button (hover over any code block)
- 📁 **File names** with appropriate icons
- 📏 **Line numbers** with proper spacing
- 🎨 **Syntax highlighting** for 19+ languages
- 📜 **Auto-collapse** for blocks >20 lines
- ↔️ **Horizontal scrolling** for long lines
- 🌊 **Smooth fade-in** animations
- 🎯 **Line highlighting** support (with MDX attributes)